---
title: "実践Atlasワークフロー"
---

Atlasを開発現場で効果的に活用するための、実践的なワークフローを紹介します。CI/CDパイプライン構築から、チームでのベストプラクティスまで解説します。

## GitHub Actionsを使ったCI/CDパイプラインの構築方法

AtlasはGitHub Actionsとの連携が簡単で、スキーマの変更を自動的に適用できます。  
以下はシンプルなCI/CD設定例です。

```yaml
name: Atlas Migration CI/CD

on:
  push:
    branches:
      - main

jobs:
  migrate:
    runs-on: ubuntu-latest
    steps:
      - name: チェックアウト
        uses: actions/checkout@v4

      - name: Atlasセットアップ
        uses: ariga/setup-atlas@v0

      - name: マイグレーションを適用
        run: |
          atlas migrate apply \
            --url "${{ secrets.DB_URL }}" \
            --dir "file://migrations"
```

- GitHub Secretsに`DB_URL`を設定して安全にDB接続情報を管理します。
- メインブランチへのpushで自動的に本番DBにマイグレーションを適用します。

## Pull Requestベースのマイグレーション管理

Pull Requestを利用したマイグレーション管理を推奨します。

### 実践フロー例：

1. 開発者がスキーマ変更を行い、差分検出でマイグレーションファイルを生成。
2. マイグレーションファイルを含めてPRを作成。
3. チームメンバーによるコードレビュー（スキーマの変更内容確認、影響範囲の評価）。
4. PR承認後にメインブランチにマージし、自動的にマイグレーションが適用される。

これにより、DBスキーマ変更の透明性と安全性が高まります。

## チームでのスキーマ管理ベストプラクティス

複数のメンバーでスキーマを管理する際のベストプラクティスは以下の通りです。

- **小さな変更を頻繁に**  
  大規模な変更を避け、小さく頻繁にマイグレーションを行うことでリスクを減らします。

- **差分の明確化**  
  HCLなどコードベースのスキーマ定義を利用して差分を明確化し、レビューを容易にします。

- **マイグレーションファイルの命名規則**  
  ファイル名を分かりやすくし、変更内容が容易に把握できるようにします（例：`20240321_add_email_column.sql`）。

- **マイグレーション前後の動作確認**  
  本番DBに適用する前に、ステージング環境やローカル環境で動作確認を徹底します。

- **定期的なスキーマ同期確認**  
  Atlasの`schema inspect`を定期的に実行し、DBのスキーマとコード定義の差異がないかを確認します。

これらを徹底することで、チーム全体で安全かつ迅速なスキーマ変更が実現できます。

次章では、Atlasのより高度な機能やカスタマイズ方法を詳しく解説します。
